<html>
  <head>
    <title>Pride</title>
  </head>

  <body>
    <script src="libraries/underscore.js"></script>
    <script src="libraries/reqwest.js"></script>
    <script src="pride.js"></script>

    <script>
    Pride.Settings.datastores_url = "http://earleyj.www.lib.umich.edu/testapp/spectrum/";
    Pride.Settings.connection_attempts = 2;
    Pride.Settings.obnoxious = true;

    const initPride = () => {
      Pride.init({
        success: () => {
          console.log('Pride loaded successfully.')
          loadPride()
        },
        failure: () => {
          console.log('Pride failed to load.')
        }
      })
    }

    const loadPride = () => {
      var search_objects = [];

      _.each(Pride.AllDatastores.array, (datastore) => {
        search_objects.push(datastore.baseSearch())
      })

      // Add results observers to each search object.
      _.each(search_objects, function(search_object) {

        console.log(search_objects)

        search_object.resultsObservers.add(function(results) {
          console.log('search_object.resultsObservers', results)
        })

        // Set data observer
        search_object.setDataObservers.add(function(data) {
          console.log('search_object.setDataObservers', data)
        })

        // run data observer
        search_object.runDataObservers.add(function(data) {
          console.log('search_object.runDataObservers', data)
        })

        search_object.set({count: 10})

        // search object facets observer
        search_object.facetsObservers.add(function(facets_data) {

          _.each(facets_data, function(facet) {
            facet.resultsObservers.add(function(results) {
              console.log('facet.resultsObservers', results)
            })

            facet.setDataObservers.add(function(data) {
              console.log('facet.setDataObservers', data)
            })
          })
        })
      })

      var search_switcher = new Pride.Util.SearchSwitcher(
        search_objects[0],
        search_objects.slice(1)
      )

      const config = {
        page: 1,
        field_tree: Pride.FieldTree.parseField('all_fields', "climate change"),
        facets: { format: 'Book' }
      }

      search_switcher.set(config).run()
    }

    initPride();

    </script>
  </body>
</html>
